<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budget Tracker</title>

  <!-- Add Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

  <!-- Your original styles here -->
  <style>
    /* All your existing styles remain unchanged */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif;
      background-color: #f8fafc;
      margin: 0;
      padding: 20px;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .back-button {
      background-color: #3b82f6;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      font-weight: 500;
    }

    .reset-button {
      color: #ef4444;
      border: none;
      background: none;
      cursor: pointer;
      font-weight: 500;
    }

    h1 {
      color: #1e293b;
      font-weight: 500;
      font-size: 24px;
      margin: 0;
      margin-left: 20px;
      display: inline-block;
    }

    .section {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-header h2 {
      font-weight: 500;
      font-size: 18px;
      margin: 0;
      color: #1e293b;
    }

    .add-button {
      background-color: #22c55e;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-transform: uppercase;
      font-weight: 500;
      color: #64748b;
      font-size: 12px;
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
      background: none;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #e2e8f0;
    }

    input, select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      font-size: 14px;
      color: #1e293b;
    }

    select {
      background-color: white;
    }

    .amount-input {
      position: relative;
    }

    .amount-input span {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #64748b;
    }

    .amount-input input {
      padding-left: 24px;
    }

    .delete-button {
      color: #ef4444;
      border: none;
      background: none;
      cursor: pointer;
      font-weight: 500;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }

    .summary-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .card-title {
      color: #64748b;
      font-size: 14px;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .card-amount {
      font-size: 24px;
      font-weight: 600;
    }

    .amount-green { color: #22c55e; }
    .amount-red { color: #ef4444; }
    .amount-blue { color: #3b82f6; }
    .amount-purple { color: #a855f7; }
  </style>
</head>
<body>
  <div class="header">
    <div>
      <a href="index.html" class="back-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        Back to Home
      </a>
      <h1>Budget Tracker</h1>
    </div>
    <button class="reset-button" onclick="resetAllData()">Reset All Data</button>
  </div>

  <div class="section">
    <div class="section-header">
      <h2>Income Sources</h2>
      <button class="add-button" onclick="addIncomeSource()">Add Income Source</button>
    </div>
    <table id="incomeTable">
      <thead>
        <tr>
          <th>Source Name</th>
          <th>Amount</th>
          <th>Frequency</th>
          <th>Monthly Total</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <div class="section-header">
      <h2>Expenses</h2>
      <button class="add-button" onclick="addExpenseRow()">Add Expense</button>
    </div>
    <table id="expenseTable">
      <thead>
        <tr>
          <th>Expense Name</th>
          <th>Total Amount</th>
          <th>Your Portion (%)</th>
          <th>Monthly</th>
          <th>Per Paycheck</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="summary-grid">
    <div class="summary-card">
      <div class="card-title">Total Monthly Income</div>
      <div class="card-amount amount-green" id="monthlyIncome">$0.00</div>
    </div>
    <div class="summary-card">
      <div class="card-title">Monthly Expenses</div>
      <div class="card-amount amount-red" id="monthlyExpenses">$0.00</div>
    </div>
    <div class="summary-card">
      <div class="card-title">Average Per Paycheck</div>
      <div class="card-amount amount-blue" id="calculatedPaycheck">$0.00</div>
    </div>
    <div class="summary-card">
      <div class="card-title">Leftover Per Paycheck</div>
      <div class="card-amount amount-purple" id="leftoverPerPaycheck">$0.00</div>
    </div>
  </div>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBfns6UFmWFDKyvLq4W6EWXe1qr1cbNuUY",
      authDomain: "budgettracker-8187e.firebaseapp.com",
      databaseURL: "https://budgettracker-8187e-default-rtdb.firebaseio.com",
      projectId: "budgettracker-8187e",
      storageBucket: "budgettracker-8187e.firebasestorage.app",
      messagingSenderId: "622910803459",
      appId: "1:622910803459:web:9761b015edc7b3f98a4836",
      measurementId: "G-Q9XBRDQL7V"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Configure auth settings
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

    // Update auth state listener
    auth.onAuthStateChanged(function(user) {
  if (!user) {
    window.location.replace('index.html');
    return;
  }
  loadUserData(user.uid);
});

    // Rest of your original functions remain unchanged
    function addIncomeSource() {
      const tbody = document.querySelector('#incomeTable tbody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>
          <input type="text" class="income-name" placeholder="Income source name">
        </td>
        <td class="amount-input">
          <span>$</span>
          <input type="number" class="income-amount" step="0.01" placeholder="0.00">
        </td>
        <td>
          <select class="income-frequency">
            <option value="monthly">Monthly (1 per month)</option>
            <option value="everyOtherWeek">Every other week (2 per month)</option>
            <option value="weekly">Weekly (4 per month)</option>
            <option value="twiceWeek">Twice a week (8 per month)</option>
          </select>
        </td>
        <td class="monthly-total">$0.00</td>
        <td>
          <button class="delete-button" onclick="removeRow(this)">Delete</button>
        </td>
      `;
      tbody.appendChild(row);
      attachListeners(row);
      saveUserData();
      return row;
    }

    function addExpenseRow() {
      const tbody = document.querySelector('#expenseTable tbody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>
          <input type="text" class="expense-name" placeholder="Expense name">
        </td>
        <td class="amount-input">
          <span>$</span>
          <input type="number" class="expense-amount" step="0.01" placeholder="0.00">
        </td>
        <td>
          <input type="number" class="expense-portion" step="0.01" value="100" min="0" max="100">
        </td>
        <td class="monthly-expense">$0.00</td>
        <td class="per-paycheck-expense">$0.00</td>
        <td>
          <button class="delete-button" onclick="removeRow(this)">Delete</button>
        </td>
      `;
      tbody.appendChild(row);
      attachListeners(row);
      saveUserData();
      return row;
    }

    function removeRow(button) {
      const row = button.closest('tr');
      row.remove();
      calculateTotals();
      saveUserData();
    }

    function attachListeners(row) {
      row.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('input', () => {
          calculateTotals();
          saveUserData();
        });
        input.addEventListener('change', () => {
          calculateTotals();
          saveUserData();
        });
      });
    }

    function getFrequencyMultiplier(frequency) {
      switch(frequency) {
        case 'weekly': return 4;
        case 'twiceWeek': return 8;
        case 'everyOtherWeek': return 2;
        case 'monthly': return 1;
        default: return 1;
      }
    }

    function calculateTotals() {
      let totalMonthlyIncome = 0;
      let totalMonthlyExpenses = 0;

      document.querySelectorAll('#incomeTable tbody tr').forEach(row => {
        const amount = parseFloat(row.querySelector('.income-amount').value) || 0;
        const frequency = row.querySelector('.income-frequency').value;
        const monthlyAmount = amount * getFrequencyMultiplier(frequency);
        
        row.querySelector('.monthly-total').textContent = `$${monthlyAmount.toFixed(2)}`;
        totalMonthlyIncome += monthlyAmount;
      });

      document.querySelectorAll('#expenseTable tbody tr').forEach(row => {
        const amount = parseFloat(row.querySelector('.expense-amount').value) || 0;
        const portion = parseFloat(row.querySelector('.expense-portion').value) || 0;
        const monthlyExpense = amount * (portion / 100);
        const perPaycheckExpense = monthlyExpense / 2;

        row.querySelector('.monthly-expense').textContent = `$${monthlyExpense.toFixed(2)}`;
        row.querySelector('.per-paycheck-expense').textContent = `$${perPaycheckExpense.toFixed(2)}`;
        totalMonthlyExpenses += monthlyExpense;
      });

      document.getElementById('monthlyIncome').textContent = `$${totalMonthlyIncome.toFixed(2)}`;
      document.getElementById('monthlyExpenses').textContent = `$${totalMonthlyExpenses.toFixed(2)}`;
      document.getElementById('calculatedPaycheck').textContent = `$${(totalMonthlyIncome / 2).toFixed(2)}`;
      document.getElementById('leftoverPerPaycheck').textContent = 
        `$${((totalMonthlyIncome - totalMonthlyExpenses) / 2).toFixed(2)}`;
    }

    async function saveUserData() {
      const user = auth.currentUser;
      if (!user) return;

      const incomeData = [];
      document.querySelectorAll('#incomeTable tbody tr').forEach(row => {
        incomeData.push({
          sourceName: row.querySelector('.income-name').value,
          amount: parseFloat(row.querySelector('.income-amount').value) || 0,
          frequency: row.querySelector('.income-frequency').value
        });
      });

      const expenseData = [];
      document.querySelectorAll('#expenseTable tbody tr').forEach(row => {
        expenseData.push({
         expenseName: row.querySelector('.expense-name').value,
         amount: parseFloat(row.querySelector('.expense-amount').value) || 0,
         portion: parseFloat(row.querySelector('.expense-portion').value) || 0
       });
     });

     try {
       await db.collection('users').doc(user.uid).set({
         income: incomeData,
         expenses: expenseData,
         lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
       });
     } catch (error) {
       console.error('Error saving data:', error);
     }
   }

   async function loadUserData(userId) {
     try {
       const doc = await db.collection('users').doc(userId).get();
       if (doc.exists) {
         const data = doc.data();
         
         document.querySelector('#incomeTable tbody').innerHTML = '';
         document.querySelector('#expenseTable tbody').innerHTML = '';

         data.income?.forEach(income => {
           const row = addIncomeSource();
           row.querySelector('.income-name').value = income.sourceName;
           row.querySelector('.income-amount').value = income.amount;
           row.querySelector('.income-frequency').value = income.frequency;
         });

         data.expenses?.forEach(expense => {
           const row = addExpenseRow();
           row.querySelector('.expense-name').value = expense.expenseName;
           row.querySelector('.expense-amount').value = expense.amount;
           row.querySelector('.expense-portion').value = expense.portion;
         });

         calculateTotals();
       }
     } catch (error) {
       console.error('Error loading data:', error);
     }
   }

   function resetAllData() {
     if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
       document.querySelector('#incomeTable tbody').innerHTML = '';
       document.querySelector('#expenseTable tbody').innerHTML = '';
       calculateTotals();
       saveUserData();
     }
   }

   calculateTotals();
 </script>
</body>
</html>